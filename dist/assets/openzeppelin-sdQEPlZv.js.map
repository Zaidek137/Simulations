{"version":3,"file":"openzeppelin-sdQEPlZv.js","sources":["../../node_modules/thirdweb/dist/esm/transaction/actions/gasless/providers/openzeppelin.js"],"sourcesContent":["import { getContract } from \"../../../../contract/contract.js\";\nimport { isHex } from \"../../../../utils/encoding/helpers/is-hex.js\";\nimport { stringify } from \"../../../../utils/json.js\";\nimport { readContract } from \"../../../read-contract.js\";\n/**\n * @internal - only exported for testing\n */\nexport async function prepareOpenZeppelinTransaction({ account, serializableTransaction, transaction, gasless, }) {\n    const forrwaderContract = getContract({\n        address: gasless.relayerForwarderAddress,\n        chain: transaction.chain,\n        client: transaction.client,\n    });\n    const nonce = await readContract({\n        contract: forrwaderContract,\n        method: \"function getNonce(address) view returns (uint256)\",\n        params: [account.address],\n    });\n    const [signature, message] = await (async () => {\n        // TODO: handle special case for `approve` -> `permit` transactions\n        if (!serializableTransaction.to) {\n            throw new Error(\"OpenZeppelin transactions must have a 'to' address\");\n        }\n        if (!serializableTransaction.gas) {\n            throw new Error(\"OpenZeppelin transactions must have a 'gas' value\");\n        }\n        if (!serializableTransaction.data) {\n            throw new Error(\"OpenZeppelin transactions must have a 'data' value\");\n        }\n        // chainless support!\n        if (gasless.experimentalChainlessSupport) {\n            const message = {\n                chainid: BigInt(transaction.chain.id),\n                data: serializableTransaction.data,\n                from: account.address,\n                gas: serializableTransaction.gas,\n                nonce: nonce,\n                to: serializableTransaction.to,\n                value: 0n,\n            };\n            return [\n                await account.signTypedData({\n                    domain: {\n                        name: \"GSNv2 Forwarder\",\n                        verifyingContract: forrwaderContract.address,\n                        version: \"0.0.1\",\n                    },\n                    message,\n                    primaryType: \"ForwardRequest\",\n                    types: { ForwardRequest: ChainAwareForwardRequest },\n                }),\n                message,\n            ];\n        }\n        // else non-chainless support\n        const message = {\n            data: serializableTransaction.data,\n            from: account.address,\n            gas: serializableTransaction.gas,\n            nonce: nonce,\n            to: serializableTransaction.to,\n            value: 0n,\n        };\n        return [\n            await account.signTypedData({\n                domain: {\n                    chainId: transaction.chain.id,\n                    name: gasless.domainName ?? \"GSNv2 Forwarder\",\n                    verifyingContract: forrwaderContract.address,\n                    version: gasless.domainVersion ?? \"0.0.1\",\n                },\n                message,\n                primaryType: \"ForwardRequest\",\n                types: { ForwardRequest },\n            }),\n            message,\n        ];\n    })();\n    // TODO: handle special case for `approve` -> `permit`\n    const messageType = \"forward\";\n    return { message, messageType, signature };\n}\nconst ForwardRequest = [\n    { name: \"from\", type: \"address\" },\n    { name: \"to\", type: \"address\" },\n    { name: \"value\", type: \"uint256\" },\n    { name: \"gas\", type: \"uint256\" },\n    { name: \"nonce\", type: \"uint256\" },\n    { name: \"data\", type: \"bytes\" },\n];\nconst ChainAwareForwardRequest = [\n    { name: \"from\", type: \"address\" },\n    { name: \"to\", type: \"address\" },\n    { name: \"value\", type: \"uint256\" },\n    { name: \"gas\", type: \"uint256\" },\n    { name: \"nonce\", type: \"uint256\" },\n    { name: \"data\", type: \"bytes\" },\n    { name: \"chainid\", type: \"uint256\" },\n];\n/**\n * @internal\n */\nexport async function relayOpenZeppelinTransaction(options) {\n    const { message, messageType, signature } = await prepareOpenZeppelinTransaction(options);\n    const response = await fetch(options.gasless.relayerUrl, {\n        body: stringify({\n            forwarderAddress: options.gasless.relayerForwarderAddress,\n            request: message,\n            signature,\n            type: messageType,\n        }),\n        method: \"POST\",\n    });\n    if (!response.ok) {\n        throw new Error(`Failed to send transaction: ${await response.text()}`);\n    }\n    const json = await response.json();\n    if (!json.result) {\n        throw new Error(`Relay transaction failed: ${json.message}`);\n    }\n    const transactionHash = JSON.parse(json.result).txHash;\n    if (isHex(transactionHash)) {\n        return {\n            chain: options.transaction.chain,\n            client: options.transaction.client,\n            transactionHash,\n        };\n    }\n    throw new Error(`Failed to send transaction: ${stringify(json)}`);\n}\n//# sourceMappingURL=openzeppelin.js.map"],"names":["prepareOpenZeppelinTransaction","account","serializableTransaction","transaction","gasless","forrwaderContract","getContract","nonce","readContract","signature","message","ChainAwareForwardRequest","ForwardRequest","relayOpenZeppelinTransaction","options","messageType","response","stringify","json","transactionHash","isHex"],"mappings":"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","x_google_ignoreList":[0]}