{"version":3,"file":"session-proposal-DFxflpN9.js","sources":["../../node_modules/thirdweb/dist/esm/wallets/wallet-connect/receiver/session-proposal.js"],"sourcesContent":["import { disconnectWalletConnectSession } from \"./index.js\";\nimport { getSessions, saveSession } from \"./session-store.js\";\n/**\n * @internal\n */\nexport async function onSessionProposal(options) {\n    const { wallet, walletConnectClient, event, chains, onConnect } = options;\n    const account = wallet.getAccount();\n    if (!account) {\n        throw new Error(\"No account connected to provided wallet\");\n    }\n    const origin = event.verifyContext?.verified?.origin;\n    if (origin) {\n        await disconnectExistingSessions({ origin, walletConnectClient });\n    }\n    const session = await acceptSessionProposal({\n        account,\n        chains,\n        sessionProposal: event,\n        walletConnectClient,\n    });\n    await saveSession(session);\n    wallet.subscribe(\"disconnect\", () => {\n        disconnectWalletConnectSession({ session, walletConnectClient });\n    });\n    onConnect?.(session);\n}\n/**\n * @internal\n */\nexport async function disconnectExistingSessions({ walletConnectClient, origin, }) {\n    const sessions = await getSessions();\n    for (const session of sessions) {\n        if (session.origin === origin) {\n            await disconnectWalletConnectSession({ session, walletConnectClient });\n        }\n    }\n}\n/**\n * @internal\n */\nexport async function acceptSessionProposal({ account, walletConnectClient, sessionProposal, chains, }) {\n    if (!sessionProposal.params.requiredNamespaces?.eip155 &&\n        !sessionProposal.params.optionalNamespaces?.eip155) {\n        throw new Error(\"No EIP155 namespace found in Wallet Connect session proposal\");\n    }\n    const namespaces = {\n        chains: [\n            ...Array.from(new Set([\n                ...(sessionProposal.params.requiredNamespaces?.eip155?.chains?.map((chain) => `${chain}:${account.address}`) ?? []),\n                ...(sessionProposal.params.optionalNamespaces?.eip155?.chains?.map((chain) => `${chain}:${account.address}`) ?? []),\n                ...(chains?.map((chain) => `eip155:${chain.id}:${account.address}`) ??\n                    []),\n            ])),\n        ],\n        events: [\n            ...(sessionProposal.params.requiredNamespaces?.eip155?.events ?? []),\n            ...(sessionProposal.params.optionalNamespaces?.eip155?.events ?? []),\n        ],\n        methods: [\n            ...(sessionProposal.params.requiredNamespaces?.eip155?.methods ?? []),\n            ...(sessionProposal.params.optionalNamespaces?.eip155?.methods ?? []),\n        ],\n    };\n    const approval = await walletConnectClient.approve({\n        id: sessionProposal.id,\n        namespaces: {\n            eip155: {\n                accounts: namespaces.chains,\n                events: namespaces.events,\n                methods: namespaces.methods,\n            },\n        },\n    });\n    const session = await approval.acknowledged();\n    return {\n        origin: sessionProposal.verifyContext?.verified?.origin || \"Unknown origin\",\n        topic: session.topic,\n    };\n}\n//# sourceMappingURL=session-proposal.js.map"],"names":["onSessionProposal","options","wallet","walletConnectClient","event","chains","onConnect","account","origin","disconnectExistingSessions","session","acceptSessionProposal","saveSession","disconnectWalletConnectSession","sessions","getSessions","sessionProposal","namespaces","chain"],"mappings":"mMAKO,eAAeA,EAAkBC,EAAS,CAC7C,KAAM,CAAE,OAAAC,EAAQ,oBAAAC,EAAqB,MAAAC,EAAO,OAAAC,EAAQ,UAAAC,CAAS,EAAKL,EAC5DM,EAAUL,EAAO,WAAU,EACjC,GAAI,CAACK,EACD,MAAM,IAAI,MAAM,yCAAyC,EAE7D,MAAMC,EAASJ,EAAM,eAAe,UAAU,OAC1CI,GACA,MAAMC,EAA2B,CAAE,OAAAD,EAAQ,oBAAAL,EAAqB,EAEpE,MAAMO,EAAU,MAAMC,EAAsB,CACxC,QAAAJ,EACA,OAAAF,EACA,gBAAiBD,EACjB,oBAAAD,CACR,CAAK,EACD,MAAMS,EAAYF,CAAO,EACzBR,EAAO,UAAU,aAAc,IAAM,CACjCW,EAA+B,CAAE,QAAAH,EAAS,oBAAAP,EAAqB,CACnE,CAAC,EACDG,IAAYI,CAAO,CACvB,CAIO,eAAeD,EAA2B,CAAE,oBAAAN,EAAqB,OAAAK,GAAW,CAC/E,MAAMM,EAAW,MAAMC,EAAW,EAClC,UAAWL,KAAWI,EACdJ,EAAQ,SAAWF,GACnB,MAAMK,EAA+B,CAAE,QAAAH,EAAS,oBAAAP,EAAqB,CAGjF,CAIO,eAAeQ,EAAsB,CAAE,QAAAJ,EAAS,oBAAAJ,EAAqB,gBAAAa,EAAiB,OAAAX,CAAM,EAAK,CACpG,GAAI,CAACW,EAAgB,OAAO,oBAAoB,QAC5C,CAACA,EAAgB,OAAO,oBAAoB,OAC5C,MAAM,IAAI,MAAM,8DAA8D,EAElF,MAAMC,EAAa,CACf,OAAQ,CACJ,GAAG,MAAM,KAAK,IAAI,IAAI,CAClB,GAAID,EAAgB,OAAO,oBAAoB,QAAQ,QAAQ,IAAKE,GAAU,GAAGA,CAAK,IAAIX,EAAQ,OAAO,EAAE,GAAK,GAChH,GAAIS,EAAgB,OAAO,oBAAoB,QAAQ,QAAQ,IAAKE,GAAU,GAAGA,CAAK,IAAIX,EAAQ,OAAO,EAAE,GAAK,GAChH,GAAIF,GAAQ,IAAKa,GAAU,UAAUA,EAAM,EAAE,IAAIX,EAAQ,OAAO,EAAE,GAC9D,EACpB,CAAa,CAAC,CACd,EACQ,OAAQ,CACJ,GAAIS,EAAgB,OAAO,oBAAoB,QAAQ,QAAU,CAAA,EACjE,GAAIA,EAAgB,OAAO,oBAAoB,QAAQ,QAAU,CAAA,CAC7E,EACQ,QAAS,CACL,GAAIA,EAAgB,OAAO,oBAAoB,QAAQ,SAAW,CAAA,EAClE,GAAIA,EAAgB,OAAO,oBAAoB,QAAQ,SAAW,CAAA,CAC9E,CACA,EAWUN,EAAU,MAVC,MAAMP,EAAoB,QAAQ,CAC/C,GAAIa,EAAgB,GACpB,WAAY,CACR,OAAQ,CACJ,SAAUC,EAAW,OACrB,OAAQA,EAAW,OACnB,QAASA,EAAW,OACpC,CACA,CACA,CAAK,GAC8B,aAAY,EAC3C,MAAO,CACH,OAAQD,EAAgB,eAAe,UAAU,QAAU,iBAC3D,MAAON,EAAQ,KACvB,CACA","x_google_ignoreList":[0]}