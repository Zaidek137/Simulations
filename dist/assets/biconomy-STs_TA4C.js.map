{"version":3,"file":"biconomy-STs_TA4C.js","sources":["../../node_modules/thirdweb/dist/esm/transaction/actions/gasless/providers/biconomy.js"],"sourcesContent":["import { encodeAbiParameters } from \"viem\";\nimport { ZERO_ADDRESS } from \"../../../../constants/addresses.js\";\nimport { getContract } from \"../../../../contract/contract.js\";\nimport { getAddress } from \"../../../../utils/address.js\";\nimport { isHex } from \"../../../../utils/encoding/helpers/is-hex.js\";\nimport { keccak256 } from \"../../../../utils/hashing/keccak256.js\";\nimport { stringify } from \"../../../../utils/json.js\";\nimport { readContract } from \"../../../read-contract.js\";\n// we do not send multiple batches so this stays consistent\nconst BATCH_ID = 0n;\n/**\n * @internal - only exported for testing\n */\nexport async function prepareBiconomyTransaction({ account, serializableTransaction, transaction, gasless, }) {\n    const forwarderContract = getContract({\n        address: gasless.relayerForwarderAddress,\n        chain: transaction.chain,\n        client: transaction.client,\n    });\n    // get the nonce\n    const nonce = await readContract({\n        contract: forwarderContract,\n        method: \"function getNonce(address,uint256) view returns (uint256)\",\n        params: [account.address, BATCH_ID],\n    });\n    const deadline = Math.floor(Date.now() / 1000) + (gasless.deadlineSeconds ?? 3600);\n    const request = {\n        batchId: BATCH_ID,\n        batchNonce: nonce,\n        data: serializableTransaction.data,\n        deadline: deadline,\n        from: account.address,\n        to: serializableTransaction.to,\n        token: ZERO_ADDRESS,\n        tokenGasPrice: 0n,\n        txGas: serializableTransaction.gas,\n    };\n    if (!request.to) {\n        throw new Error(\"Cannot send a transaction without a `to` address\");\n    }\n    if (!request.txGas) {\n        throw new Error(\"Cannot send a transaction without a `gas` value\");\n    }\n    if (!request.data) {\n        throw new Error(\"Cannot send a transaction without a `data` value\");\n    }\n    // create the hash\n    const message = encodeAbiParameters([\n        { type: \"address\" },\n        { type: \"address\" },\n        { type: \"address\" },\n        { type: \"uint256\" },\n        { type: \"uint256\" },\n        { type: \"uint256\" },\n        { type: \"uint256\" },\n        { type: \"bytes32\" },\n    ], [\n        getAddress(request.from),\n        getAddress(request.to),\n        getAddress(request.token),\n        request.txGas,\n        request.tokenGasPrice,\n        request.batchId,\n        request.batchNonce,\n        keccak256(request.data),\n    ]);\n    const signature = await account.signMessage({ message });\n    return [request, signature];\n}\n/**\n * @internal\n */\nexport async function relayBiconomyTransaction(options) {\n    const [request, signature] = await prepareBiconomyTransaction(options);\n    // send the transaction to the biconomy api\n    const response = await fetch(\"https://api.biconomy.io/api/v2/meta-tx/native\", {\n        body: stringify({\n            apiId: options.gasless.apiId,\n            from: request.from,\n            gasLimit: request.txGas,\n            params: [request, signature],\n            to: request.to,\n        }),\n        headers: {\n            \"Content-Type\": \"application/json;charset=utf-8\",\n            \"x-api-key\": options.gasless.apiKey,\n        },\n        method: \"POST\",\n    });\n    if (!response.ok) {\n        throw new Error(`Failed to send transaction: ${await response.text()}`);\n    }\n    const json = await response.json();\n    const transactionHash = json.txHash;\n    if (isHex(transactionHash)) {\n        return {\n            chain: options.transaction.chain,\n            client: options.transaction.client,\n            transactionHash: transactionHash,\n        };\n    }\n    throw new Error(`Failed to send transaction: ${stringify(json)}`);\n}\n//# sourceMappingURL=biconomy.js.map"],"names":["BATCH_ID","prepareBiconomyTransaction","account","serializableTransaction","transaction","gasless","forwarderContract","getContract","nonce","readContract","deadline","request","ZERO_ADDRESS","message","encodeAbiParameters","getAddress","keccak256","signature","relayBiconomyTransaction","options","response","stringify","json","transactionHash","isHex"],"mappings":"sOASA,MAAMA,EAAW,GAIV,eAAeC,EAA2B,CAAE,QAAAC,EAAS,wBAAAC,EAAyB,YAAAC,EAAa,QAAAC,CAAO,EAAK,CAC1G,MAAMC,EAAoBC,EAAY,CAClC,QAASF,EAAQ,wBACjB,MAAOD,EAAY,MACnB,OAAQA,EAAY,MAC5B,CAAK,EAEKI,EAAQ,MAAMC,EAAa,CAC7B,SAAUH,EACV,OAAQ,4DACR,OAAQ,CAACJ,EAAQ,QAASF,CAAQ,CAC1C,CAAK,EACKU,EAAW,KAAK,MAAM,KAAK,MAAQ,GAAI,GAAKL,EAAQ,iBAAmB,MACvEM,EAAU,CACZ,QAASX,EACT,WAAYQ,EACZ,KAAML,EAAwB,KAC9B,SAAUO,EACV,KAAMR,EAAQ,QACd,GAAIC,EAAwB,GAC5B,MAAOS,EACP,cAAe,GACf,MAAOT,EAAwB,GACvC,EACI,GAAI,CAACQ,EAAQ,GACT,MAAM,IAAI,MAAM,kDAAkD,EAEtE,GAAI,CAACA,EAAQ,MACT,MAAM,IAAI,MAAM,iDAAiD,EAErE,GAAI,CAACA,EAAQ,KACT,MAAM,IAAI,MAAM,kDAAkD,EAGtE,MAAME,EAAUC,EAAoB,CAChC,CAAE,KAAM,SAAS,EACjB,CAAE,KAAM,SAAS,EACjB,CAAE,KAAM,SAAS,EACjB,CAAE,KAAM,SAAS,EACjB,CAAE,KAAM,SAAS,EACjB,CAAE,KAAM,SAAS,EACjB,CAAE,KAAM,SAAS,EACjB,CAAE,KAAM,SAAS,CACzB,EAAO,CACCC,EAAWJ,EAAQ,IAAI,EACvBI,EAAWJ,EAAQ,EAAE,EACrBI,EAAWJ,EAAQ,KAAK,EACxBA,EAAQ,MACRA,EAAQ,cACRA,EAAQ,QACRA,EAAQ,WACRK,EAAUL,EAAQ,IAAI,CAC9B,CAAK,EACKM,EAAY,MAAMf,EAAQ,YAAY,CAAE,QAAAW,CAAO,CAAE,EACvD,MAAO,CAACF,EAASM,CAAS,CAC9B,CAIO,eAAeC,EAAyBC,EAAS,CACpD,KAAM,CAACR,EAASM,CAAS,EAAI,MAAMhB,EAA2BkB,CAAO,EAE/DC,EAAW,MAAM,MAAM,gDAAiD,CAC1E,KAAMC,EAAU,CACZ,MAAOF,EAAQ,QAAQ,MACvB,KAAMR,EAAQ,KACd,SAAUA,EAAQ,MAClB,OAAQ,CAACA,EAASM,CAAS,EAC3B,GAAIN,EAAQ,EACxB,CAAS,EACD,QAAS,CACL,eAAgB,iCAChB,YAAaQ,EAAQ,QAAQ,MACzC,EACQ,OAAQ,MAChB,CAAK,EACD,GAAI,CAACC,EAAS,GACV,MAAM,IAAI,MAAM,+BAA+B,MAAMA,EAAS,KAAI,CAAE,EAAE,EAE1E,MAAME,EAAO,MAAMF,EAAS,KAAI,EAC1BG,EAAkBD,EAAK,OAC7B,GAAIE,EAAMD,CAAe,EACrB,MAAO,CACH,MAAOJ,EAAQ,YAAY,MAC3B,OAAQA,EAAQ,YAAY,OAC5B,gBAAiBI,CAC7B,EAEI,MAAM,IAAI,MAAM,+BAA+BF,EAAUC,CAAI,CAAC,EAAE,CACpE","x_google_ignoreList":[0]}