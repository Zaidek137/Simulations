import{am as Pe,an as Et,ao as At,ap as Ce,aq as Ie,ar as Oe,as as Ee,at as Ae,au as je,av as He,aw as jt,ax as it,ay as $e,az as V,aA as te,aB as tt,aC as j,aD as ee,aE as K,aF as nt,aG as re,aH as Se}from"./index-D2Em5isd.js";import{g as De}from"./react-vendor-hc9cV1gX.js";import"./framer-motion-BLeoVWJg.js";import"./d3-vendor-DXMZTTbz.js";import"./supabase-vendor-CzrfDcjy.js";var dt={exports:{}};(function(r,t){var e=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof globalThis<"u"&&globalThis,s=function(){function o(){this.fetch=!1,this.DOMException=e.DOMException}return o.prototype=e,new o}();(function(o){(function(i){var h=typeof o<"u"&&o||typeof self<"u"&&self||typeof o<"u"&&o||{},u={searchParams:"URLSearchParams"in h,iterable:"Symbol"in h&&"iterator"in Symbol,blob:"FileReader"in h&&"Blob"in h&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in h,arrayBuffer:"ArrayBuffer"in h};function m(n){return n&&DataView.prototype.isPrototypeOf(n)}if(u.arrayBuffer)var b=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],f=ArrayBuffer.isView||function(n){return n&&b.indexOf(Object.prototype.toString.call(n))>-1};function C(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(n)||n==="")throw new TypeError('Invalid character in header field name: "'+n+'"');return n.toLowerCase()}function w(n){return typeof n!="string"&&(n=String(n)),n}function N(n){var c={next:function(){var l=n.shift();return{done:l===void 0,value:l}}};return u.iterable&&(c[Symbol.iterator]=function(){return c}),c}function g(n){this.map={},n instanceof g?n.forEach(function(c,l){this.append(l,c)},this):Array.isArray(n)?n.forEach(function(c){if(c.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+c.length);this.append(c[0],c[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(c){this.append(c,n[c])},this)}g.prototype.append=function(n,c){n=C(n),c=w(c);var l=this.map[n];this.map[n]=l?l+", "+c:c},g.prototype.delete=function(n){delete this.map[C(n)]},g.prototype.get=function(n){return n=C(n),this.has(n)?this.map[n]:null},g.prototype.has=function(n){return this.map.hasOwnProperty(C(n))},g.prototype.set=function(n,c){this.map[C(n)]=w(c)},g.prototype.forEach=function(n,c){for(var l in this.map)this.map.hasOwnProperty(l)&&n.call(c,this.map[l],l,this)},g.prototype.keys=function(){var n=[];return this.forEach(function(c,l){n.push(l)}),N(n)},g.prototype.values=function(){var n=[];return this.forEach(function(c){n.push(c)}),N(n)},g.prototype.entries=function(){var n=[];return this.forEach(function(c,l){n.push([l,c])}),N(n)},u.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function et(n){if(!n._noBody){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}}function Pt(n){return new Promise(function(c,l){n.onload=function(){c(n.result)},n.onerror=function(){l(n.error)}})}function de(n){var c=new FileReader,l=Pt(c);return c.readAsArrayBuffer(n),l}function fe(n){var c=new FileReader,l=Pt(c),v=/charset=([A-Za-z0-9_-]+)/.exec(n.type),y=v?v[1]:"utf-8";return c.readAsText(n,y),l}function me(n){for(var c=new Uint8Array(n),l=new Array(c.length),v=0;v<c.length;v++)l[v]=String.fromCharCode(c[v]);return l.join("")}function Ct(n){if(n.slice)return n.slice(0);var c=new Uint8Array(n.byteLength);return c.set(new Uint8Array(n)),c.buffer}function It(){return this.bodyUsed=!1,this._initBody=function(n){this.bodyUsed=this.bodyUsed,this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:u.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:u.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:u.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():u.arrayBuffer&&u.blob&&m(n)?(this._bodyArrayBuffer=Ct(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):u.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||f(n))?this._bodyArrayBuffer=Ct(n):this._bodyText=n=Object.prototype.toString.call(n):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):u.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},u.blob&&(this.blob=function(){var n=et(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var n=et(this);return n||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(u.blob)return this.blob().then(de);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var n=et(this);if(n)return n;if(this._bodyBlob)return fe(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(me(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},u.formData&&(this.formData=function(){return this.text().then(ye)}),this.json=function(){return this.text().then(JSON.parse)},this}var ve=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function ge(n){var c=n.toUpperCase();return ve.indexOf(c)>-1?c:n}function $(n,c){if(!(this instanceof $))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');c=c||{};var l=c.body;if(n instanceof $){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,c.headers||(this.headers=new g(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!l&&n._bodyInit!=null&&(l=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=c.credentials||this.credentials||"same-origin",(c.headers||!this.headers)&&(this.headers=new g(c.headers)),this.method=ge(c.method||this.method||"GET"),this.mode=c.mode||this.mode||null,this.signal=c.signal||this.signal||function(){if("AbortController"in h){var p=new AbortController;return p.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&l)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(l),(this.method==="GET"||this.method==="HEAD")&&(c.cache==="no-store"||c.cache==="no-cache")){var v=/([?&])_=[^&]*/;if(v.test(this.url))this.url=this.url.replace(v,"$1_="+new Date().getTime());else{var y=/\?/;this.url+=(y.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}$.prototype.clone=function(){return new $(this,{body:this._bodyInit})};function ye(n){var c=new FormData;return n.trim().split("&").forEach(function(l){if(l){var v=l.split("="),y=v.shift().replace(/\+/g," "),p=v.join("=").replace(/\+/g," ");c.append(decodeURIComponent(y),decodeURIComponent(p))}}),c}function be(n){var c=new g,l=n.replace(/\r?\n[\t ]+/g," ");return l.split("\r").map(function(v){return v.indexOf(`
`)===0?v.substr(1,v.length):v}).forEach(function(v){var y=v.split(":"),p=y.shift().trim();if(p){var W=y.join(":").trim();try{c.append(p,W)}catch(st){console.warn("Response "+st.message)}}}),c}It.call($.prototype);function A(n,c){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(c||(c={}),this.type="default",this.status=c.status===void 0?200:c.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=c.statusText===void 0?"":""+c.statusText,this.headers=new g(c.headers),this.url=c.url||"",this._initBody(n)}It.call(A.prototype),A.prototype.clone=function(){return new A(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},A.error=function(){var n=new A(null,{status:200,statusText:""});return n.ok=!1,n.status=0,n.type="error",n};var we=[301,302,303,307,308];A.redirect=function(n,c){if(we.indexOf(c)===-1)throw new RangeError("Invalid status code");return new A(null,{status:c,headers:{location:n}})},i.DOMException=h.DOMException;try{new i.DOMException}catch{i.DOMException=function(c,l){this.message=c,this.name=l;var v=Error(c);this.stack=v.stack},i.DOMException.prototype=Object.create(Error.prototype),i.DOMException.prototype.constructor=i.DOMException}function rt(n,c){return new Promise(function(l,v){var y=new $(n,c);if(y.signal&&y.signal.aborted)return v(new i.DOMException("Aborted","AbortError"));var p=new XMLHttpRequest;function W(){p.abort()}p.onload=function(){var P={statusText:p.statusText,headers:be(p.getAllResponseHeaders()||"")};y.url.indexOf("file://")===0&&(p.status<200||p.status>599)?P.status=200:P.status=p.status,P.url="responseURL"in p?p.responseURL:P.headers.get("X-Request-URL");var S="response"in p?p.response:p.responseText;setTimeout(function(){l(new A(S,P))},0)},p.onerror=function(){setTimeout(function(){v(new TypeError("Network request failed"))},0)},p.ontimeout=function(){setTimeout(function(){v(new TypeError("Network request timed out"))},0)},p.onabort=function(){setTimeout(function(){v(new i.DOMException("Aborted","AbortError"))},0)};function st(P){try{return P===""&&h.location.href?h.location.href:P}catch{return P}}if(p.open(y.method,st(y.url),!0),y.credentials==="include"?p.withCredentials=!0:y.credentials==="omit"&&(p.withCredentials=!1),"responseType"in p&&(u.blob?p.responseType="blob":u.arrayBuffer&&(p.responseType="arraybuffer")),c&&typeof c.headers=="object"&&!(c.headers instanceof g||h.Headers&&c.headers instanceof h.Headers)){var Ot=[];Object.getOwnPropertyNames(c.headers).forEach(function(P){Ot.push(C(P)),p.setRequestHeader(P,w(c.headers[P]))}),y.headers.forEach(function(P,S){Ot.indexOf(S)===-1&&p.setRequestHeader(S,P)})}else y.headers.forEach(function(P,S){p.setRequestHeader(S,P)});y.signal&&(y.signal.addEventListener("abort",W),p.onreadystatechange=function(){p.readyState===4&&y.signal.removeEventListener("abort",W)}),p.send(typeof y._bodyInit>"u"?null:y._bodyInit)})}return rt.polyfill=!0,h.fetch||(h.fetch=rt,h.Headers=g,h.Request=$,h.Response=A),i.Headers=g,i.Request=$,i.Response=A,i.fetch=rt,Object.defineProperty(i,"__esModule",{value:!0}),i})({})})(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var a=e.fetch?e:s;t=a.fetch,t.default=a.fetch,t.fetch=a.fetch,t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response,r.exports=t})(dt,dt.exports);var qe=dt.exports;const Ht=De(qe);var _e=Object.defineProperty,Ne=Object.defineProperties,Te=Object.getOwnPropertyDescriptors,$t=Object.getOwnPropertySymbols,Re=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable,St=(r,t,e)=>t in r?_e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Dt=(r,t)=>{for(var e in t||(t={}))Re.call(t,e)&&St(r,e,t[e]);if($t)for(var e of $t(t))xe.call(t,e)&&St(r,e,t[e]);return r},qt=(r,t)=>Ne(r,Te(t));const Be={Accept:"application/json","Content-Type":"application/json"},Ue="POST",_t={headers:Be,method:Ue},Nt=10;let H=class{constructor(t,e=!1){if(this.url=t,this.disableProviderPing=e,this.events=new Pe.EventEmitter,this.isAvailable=!1,this.registering=!1,!Et(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=e}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t){this.isAvailable||await this.register();try{const e=At(t),s=await(await Ht(this.url,qt(Dt({},_t),{body:e}))).json();this.onPayload({data:s})}catch(e){this.onError(t.id,e)}}async register(t=this.url){if(!Et(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const e=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=e||this.events.listenerCount("open")>=e)&&this.events.setMaxListeners(e+1),new Promise((s,a)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),a(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return a(new Error("HTTP connection is missing or invalid"));s()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const e=At({id:1,jsonrpc:"2.0",method:"test",params:[]});await Ht(t,qt(Dt({},_t),{body:e}))}this.onOpen()}catch(e){const s=this.parseError(e);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const e=typeof t.data=="string"?Ce(t.data):t.data;this.events.emit("payload",e)}onError(t,e){const s=this.parseError(e),a=s.message||s.toString(),o=Ie(t,a);this.events.emit("payload",o)}parseError(t,e=this.url){return Oe(t,e,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Nt&&this.events.setMaxListeners(Nt)}};const Tt="error",Fe="wss://relay.walletconnect.org",Me="wc",Le="universal_provider",X=`${Me}@2:${Le}:`,se="https://rpc.walletconnect.org/v1/",ie="generic",ke=`${se}bundler`,J="call_status",ze=86400,E={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function gt(r){return r==null||typeof r!="object"&&typeof r!="function"}function ne(r){return Object.getOwnPropertySymbols(r).filter(t=>Object.prototype.propertyIsEnumerable.call(r,t))}function ae(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const Ge="[object RegExp]",oe="[object String]",ce="[object Number]",he="[object Boolean]",ue="[object Arguments]",Je="[object Symbol]",Ve="[object Date]",Ke="[object Map]",We="[object Set]",Xe="[object Array]",Ye="[object ArrayBuffer]",Ze="[object Object]",Qe="[object DataView]",tr="[object Uint8Array]",er="[object Uint8ClampedArray]",rr="[object Uint16Array]",sr="[object Uint32Array]",ir="[object Int8Array]",nr="[object Int16Array]",ar="[object Int32Array]",or="[object Float32Array]",cr="[object Float64Array]";function yt(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function hr(r,t){return G(r,void 0,r,new Map,t)}function G(r,t,e,s=new Map,a=void 0){const o=a?.(r,t,e,s);if(o!=null)return o;if(gt(r))return r;if(s.has(r))return s.get(r);if(Array.isArray(r)){const i=new Array(r.length);s.set(r,i);for(let h=0;h<r.length;h++)i[h]=G(r[h],h,e,s,a);return Object.hasOwn(r,"index")&&(i.index=r.index),Object.hasOwn(r,"input")&&(i.input=r.input),i}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp){const i=new RegExp(r.source,r.flags);return i.lastIndex=r.lastIndex,i}if(r instanceof Map){const i=new Map;s.set(r,i);for(const[h,u]of r)i.set(h,G(u,h,e,s,a));return i}if(r instanceof Set){const i=new Set;s.set(r,i);for(const h of r)i.add(G(h,void 0,e,s,a));return i}if(typeof Buffer<"u"&&Buffer.isBuffer(r))return r.subarray();if(yt(r)){const i=new(Object.getPrototypeOf(r)).constructor(r.length);s.set(r,i);for(let h=0;h<r.length;h++)i[h]=G(r[h],h,e,s,a);return i}if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);if(r instanceof DataView){const i=new DataView(r.buffer.slice(0),r.byteOffset,r.byteLength);return s.set(r,i),q(i,r,e,s,a),i}if(typeof File<"u"&&r instanceof File){const i=new File([r],r.name,{type:r.type});return s.set(r,i),q(i,r,e,s,a),i}if(r instanceof Blob){const i=new Blob([r],{type:r.type});return s.set(r,i),q(i,r,e,s,a),i}if(r instanceof Error){const i=new r.constructor;return s.set(r,i),i.message=r.message,i.name=r.name,i.stack=r.stack,i.cause=r.cause,q(i,r,e,s,a),i}if(typeof r=="object"&&ur(r)){const i=Object.create(Object.getPrototypeOf(r));return s.set(r,i),q(i,r,e,s,a),i}return r}function q(r,t,e=r,s,a){const o=[...Object.keys(t),...ne(t)];for(let i=0;i<o.length;i++){const h=o[i],u=Object.getOwnPropertyDescriptor(r,h);(u==null||u.writable)&&(r[h]=G(t[h],h,e,s,a))}}function ur(r){switch(ae(r)){case ue:case Xe:case Ye:case Qe:case he:case Ve:case or:case cr:case ir:case nr:case ar:case Ke:case ce:case Ze:case Ge:case We:case oe:case Je:case tr:case er:case rr:case sr:return!0;default:return!1}}function lr(r,t){return hr(r,(e,s,a,o)=>{if(typeof r=="object")switch(Object.prototype.toString.call(r)){case ce:case oe:case he:{const i=new r.constructor(r?.valueOf());return q(i,r),i}case ue:{const i={};return q(i,r),i.length=r.length,i[Symbol.iterator]=r[Symbol.iterator],i}default:return}})}function Rt(r){return lr(r)}function xt(r){return r!==null&&typeof r=="object"&&ae(r)==="[object Arguments]"}function Bt(r){return typeof r=="object"&&r!==null}function pr(){}function dr(r){return yt(r)}function fr(r){if(typeof r!="object"||r==null)return!1;if(Object.getPrototypeOf(r)===null)return!0;if(Object.prototype.toString.call(r)!=="[object Object]"){const e=r[Symbol.toStringTag];return e==null||!Object.getOwnPropertyDescriptor(r,Symbol.toStringTag)?.writable?!1:r.toString()===`[object ${e}]`}let t=r;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(r)===t}function mr(r){if(gt(r))return r;if(Array.isArray(r)||yt(r)||r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);const t=Object.getPrototypeOf(r),e=t.constructor;if(r instanceof Date||r instanceof Map||r instanceof Set)return new e(r);if(r instanceof RegExp){const s=new e(r);return s.lastIndex=r.lastIndex,s}if(r instanceof DataView)return new e(r.buffer.slice(0));if(r instanceof Error){const s=new e(r.message);return s.stack=r.stack,s.name=r.name,s.cause=r.cause,s}if(typeof File<"u"&&r instanceof File)return new e([r],r.name,{type:r.type,lastModified:r.lastModified});if(typeof r=="object"){const s=Object.create(t);return Object.assign(s,r)}return r}function vr(r,...t){const e=t.slice(0,-1),s=t[t.length-1];let a=r;for(let o=0;o<e.length;o++){const i=e[o];a=ft(a,i,s,new Map)}return a}function ft(r,t,e,s){if(gt(r)&&(r=Object(r)),t==null||typeof t!="object")return r;if(s.has(t))return mr(s.get(t));if(s.set(t,r),Array.isArray(t)){t=t.slice();for(let o=0;o<t.length;o++)t[o]=t[o]??void 0}const a=[...Object.keys(t),...ne(t)];for(let o=0;o<a.length;o++){const i=a[o];let h=t[i],u=r[i];if(xt(h)&&(h={...h}),xt(u)&&(u={...u}),typeof Buffer<"u"&&Buffer.isBuffer(h)&&(h=Rt(h)),Array.isArray(h))if(typeof u=="object"&&u!=null){const b=[],f=Reflect.ownKeys(u);for(let C=0;C<f.length;C++){const w=f[C];b[w]=u[w]}u=b}else u=[];const m=e(u,h,i,r,t,s);m!=null?r[i]=m:Array.isArray(h)||Bt(u)&&Bt(h)?r[i]=ft(u,h,e,s):u==null&&fr(h)?r[i]=ft({},h,e,s):u==null&&dr(h)?r[i]=Rt(h):(u===void 0||h!==void 0)&&(r[i]=h)}return r}function gr(r,...t){return vr(r,...t,pr)}var yr=Object.defineProperty,br=Object.defineProperties,wr=Object.getOwnPropertyDescriptors,Ut=Object.getOwnPropertySymbols,Pr=Object.prototype.hasOwnProperty,Cr=Object.prototype.propertyIsEnumerable,Ft=(r,t,e)=>t in r?yr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Y=(r,t)=>{for(var e in t||(t={}))Pr.call(t,e)&&Ft(r,e,t[e]);if(Ut)for(var e of Ut(t))Cr.call(t,e)&&Ft(r,e,t[e]);return r},Ir=(r,t)=>br(r,wr(t));function I(r,t,e){var s;const a=tt(r);return((s=t.rpcMap)==null?void 0:s[a.reference])||`${se}?chainId=${a.namespace}:${a.reference}&projectId=${e}`}function _(r){return r.includes(":")?r.split(":")[1]:r}function le(r){return r.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function Or(r,t){const e=Object.keys(t.namespaces).filter(a=>a.includes(r));if(!e.length)return[];const s=[];return e.forEach(a=>{const o=t.namespaces[a].accounts;s.push(...o)}),s}function Mt(r){return Object.fromEntries(Object.entries(r).filter(([t,e])=>{var s,a;return((s=e?.chains)==null?void 0:s.length)&&((a=e?.chains)==null?void 0:a.length)>0}))}function Z(r={},t={}){const e=Mt(Lt(r)),s=Mt(Lt(t));return gr(e,s)}function Lt(r){var t,e,s,a,o;const i={};if(!K(r))return i;for(const[h,u]of Object.entries(r)){const m=te(h)?[h]:u.chains,b=u.methods||[],f=u.events||[],C=u.rpcMap||{},w=V(h);i[w]=Ir(Y(Y({},i[w]),u),{chains:nt(m,(t=i[w])==null?void 0:t.chains),methods:nt(b,(e=i[w])==null?void 0:e.methods),events:nt(f,(s=i[w])==null?void 0:s.events)}),(K(C)||K(((a=i[w])==null?void 0:a.rpcMap)||{}))&&(i[w].rpcMap=Y(Y({},C),(o=i[w])==null?void 0:o.rpcMap))}return i}function kt(r){return r.includes(":")?r.split(":")[2]:r}function zt(r){const t={};for(const[e,s]of Object.entries(r)){const a=s.methods||[],o=s.events||[],i=s.accounts||[],h=te(e)?[e]:s.chains?s.chains:le(s.accounts);t[e]={chains:h,methods:a,events:o,accounts:i}}return t}function at(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}function Er(r){try{const t=JSON.parse(r);return typeof t=="object"&&t!==null&&!Array.isArray(t)}catch{return!1}}const pe={},d=r=>pe[r],ot=(r,t)=>{pe[r]=t};var Ar=Object.defineProperty,Gt=Object.getOwnPropertySymbols,jr=Object.prototype.hasOwnProperty,Hr=Object.prototype.propertyIsEnumerable,Jt=(r,t,e)=>t in r?Ar(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Vt=(r,t)=>{for(var e in t||(t={}))jr.call(t,e)&&Jt(r,e,t[e]);if(Gt)for(var e of Gt(t))Hr.call(t,e)&&Jt(r,e,t[e]);return r};const Kt="eip155",$r=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],Sr=r=>r&&r.startsWith("0x")?BigInt(r).toString(10):r,ct=r=>r&&r.startsWith("0x")?r:`0x${BigInt(r).toString(16)}`,Wt=r=>Object.keys(r).filter(t=>$r.includes(t)).reduce((t,e)=>(t[e]=Dr(r[e]),t),{}),Dr=r=>typeof r=="string"&&Er(r)?JSON.parse(r):r,qr=(r,t,e)=>{const{sessionProperties:s={},scopedProperties:a={}}=r,o={};if(!K(a)&&!K(s))return;const i=Wt(s);for(const h of e){const u=Sr(h);if(!u)continue;o[ct(u)]=i;const m=a?.[`${Kt}:${u}`];if(m){const b=m?.[`${Kt}:${u}:${t}`];o[ct(u)]=Vt(Vt({},o[ct(u)]),Wt(b||m))}}for(const[h,u]of Object.entries(o))Object.keys(u).length===0&&delete o[h];return Object.keys(o).length>0?o:void 0};var _r=Object.defineProperty,Nr=(r,t,e)=>t in r?_r(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Tr=(r,t,e)=>Nr(r,t+"",e);let ht;class bt{constructor(t){Tr(this,"storage"),this.storage=t}async getItem(t){return await this.storage.getItem(t)}async setItem(t,e){return await this.storage.setItem(t,e)}async removeItem(t){return await this.storage.removeItem(t)}static getStorage(t){return ht||(ht=new bt(t)),ht}}var Rr=Object.defineProperty,xr=Object.defineProperties,Br=Object.getOwnPropertyDescriptors,Xt=Object.getOwnPropertySymbols,Ur=Object.prototype.hasOwnProperty,Fr=Object.prototype.propertyIsEnumerable,Yt=(r,t,e)=>t in r?Rr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Mr=(r,t)=>{for(var e in t||(t={}))Ur.call(t,e)&&Yt(r,e,t[e]);if(Xt)for(var e of Xt(t))Fr.call(t,e)&&Yt(r,e,t[e]);return r},Lr=(r,t)=>xr(r,Br(t));async function kr(r,t){const e=tt(r.result.capabilities.caip345.caip2),s=r.result.capabilities.caip345.transactionHashes,a=await Promise.allSettled(s.map(f=>zr(e.reference,f,t))),o=a.filter(f=>f.status==="fulfilled").map(f=>f.value).filter(f=>f);a.filter(f=>f.status==="rejected").forEach(f=>console.warn("Failed to fetch transaction receipt:",f.reason));const i=!o.length||o.some(f=>!f),h=o.every(f=>f?.status==="0x1"),u=o.every(f=>f?.status==="0x0"),m=o.some(f=>f?.status==="0x0");let b;return i?b=100:h?b=200:u?b=500:m&&(b=600),{id:r.result.id,version:r.request.version,atomic:r.request.atomicRequired,chainId:r.request.chainId,capabilities:r.result.capabilities,receipts:o,status:b}}async function zr(r,t,e){return await e(parseInt(r)).request(ee("eth_getTransactionReceipt",[t]))}async function Gr({sendCalls:r,storage:t}){const e=await t.getItem(J);await t.setItem(J,Lr(Mr({},e),{[r.result.id]:{request:r.request,result:r.result,expiry:Se(ze)}}))}async function Jr({resultId:r,storage:t}){const e=await t.getItem(J);if(e){delete e[r],await t.setItem(J,e);for(const s in e)re(e[s].expiry)&&delete e[s];await t.setItem(J,e)}}async function Vr({resultId:r,storage:t}){const e=await t.getItem(J),s=e?.[r];if(s&&!re(s.expiry))return s;await Jr({resultId:r,storage:t})}var Kr=Object.defineProperty,Wr=(r,t,e)=>t in r?Kr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,T=(r,t,e)=>Wr(r,typeof t!="symbol"?t+"":t,e);class Xr{constructor(t){T(this,"name","polkadot"),T(this,"client"),T(this,"httpProviders"),T(this,"events"),T(this,"namespace"),T(this,"chainId"),this.namespace=t.namespace,this.events=d("events"),this.client=d("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(E.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var s;const a=_(e);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){const s=e||I(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new j(new H(s,d("disableProviderPing")))}}var Yr=Object.defineProperty,Zr=Object.defineProperties,Qr=Object.getOwnPropertyDescriptors,Zt=Object.getOwnPropertySymbols,ts=Object.prototype.hasOwnProperty,es=Object.prototype.propertyIsEnumerable,mt=(r,t,e)=>t in r?Yr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,ut=(r,t)=>{for(var e in t||(t={}))ts.call(t,e)&&mt(r,e,t[e]);if(Zt)for(var e of Zt(t))es.call(t,e)&&mt(r,e,t[e]);return r},lt=(r,t)=>Zr(r,Qr(t)),D=(r,t,e)=>mt(r,typeof t!="symbol"?t+"":t,e);class rs{constructor(t){D(this,"name","eip155"),D(this,"client"),D(this,"chainId"),D(this,"namespace"),D(this,"httpProviders"),D(this,"events"),D(this,"storage"),this.namespace=t.namespace,this.events=d("events"),this.client=d("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=bt.getStorage(this.client.core.storage)}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(t);case"wallet_getCallsStatus":return await this.getCallStatus(t);case"wallet_sendCalls":return await this.sendCalls(t)}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(parseInt(t),e),this.chainId=parseInt(t),this.events.emit(E.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,e){const s=e||I(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new j(new H(s,d("disableProviderPing")))}setHttpProvider(t,e){const s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var s;const a=parseInt(_(e));t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[e])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}getHttpProvider(t){const e=t||this.chainId;return this.httpProviders[e]||(this.httpProviders=lt(ut({},this.httpProviders),{[e]:this.createHttpProvider(e)}),this.httpProviders[e])}async handleSwitchChain(t){var e,s;let a=t.request.params?(e=t.request.params[0])==null?void 0:e.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const o=parseInt(a,16);if(this.isChainApproved(o))this.setDefaultChain(`${o}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${o}`);else throw new Error(`Failed to switch to chain 'eip155:${o}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}async getCapabilities(t){var e,s,a,o,i;const h=(s=(e=t.request)==null?void 0:e.params)==null?void 0:s[0],u=((o=(a=t.request)==null?void 0:a.params)==null?void 0:o[1])||[];if(!h)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const m=this.client.session.get(t.topic),b=((i=m?.sessionProperties)==null?void 0:i.capabilities)||{},f=`${h}${u.join(",")}`,C=b?.[f];if(C)return C;let w;try{w=qr(m,h,u)}catch(g){console.warn("Failed to extract capabilities from session",g)}if(w)return w;const N=await this.client.request(t);try{await this.client.session.update(t.topic,{sessionProperties:lt(ut({},m.sessionProperties||{}),{capabilities:lt(ut({},b||{}),{[f]:N})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return N}async getCallStatus(t){var e,s,a;const o=this.client.session.get(t.topic),i=(e=o.sessionProperties)==null?void 0:e.bundler_name;if(i){const m=this.getBundlerUrl(t.chainId,i);try{return await this.getUserOperationReceipt(m,t)}catch(b){console.warn("Failed to fetch call status from bundler",b,m)}}const h=(s=o.sessionProperties)==null?void 0:s.bundler_url;if(h)try{return await this.getUserOperationReceipt(h,t)}catch(m){console.warn("Failed to fetch call status from custom bundler",m,h)}const u=await Vr({resultId:(a=t.request.params)==null?void 0:a[0],storage:this.storage});if(u)try{return await kr(u,this.getHttpProvider.bind(this))}catch(m){console.warn("Failed to fetch call status from stored send calls",m,u)}if(this.namespace.methods.includes(t.request.method))return await this.client.request(t);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(t,e){var s;const a=new URL(t),o=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ee("eth_getUserOperationReceipt",[(s=e.request.params)==null?void 0:s[0]]))});if(!o.ok)throw new Error(`Failed to fetch user operation receipt - ${o.status}`);return await o.json()}getBundlerUrl(t,e){return`${ke}?projectId=${this.client.core.projectId}&chainId=${t}&bundler=${e}`}async sendCalls(t){var e,s,a;const o=await this.client.request(t),i=(e=t.request.params)==null?void 0:e[0],h=o?.id,u=o?.capabilities||{},m=(s=u?.caip345)==null?void 0:s.caip2,b=(a=u?.caip345)==null?void 0:a.transactionHashes;return!h||!m||!(b!=null&&b.length)||await Gr({sendCalls:{request:i,result:o},storage:this.storage}),o}}var ss=Object.defineProperty,is=(r,t,e)=>t in r?ss(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,R=(r,t,e)=>is(r,typeof t!="symbol"?t+"":t,e);class ns{constructor(t){R(this,"name","solana"),R(this,"client"),R(this,"httpProviders"),R(this,"events"),R(this,"namespace"),R(this,"chainId"),this.namespace=t.namespace,this.events=d("events"),this.client=d("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(E.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var s;const a=_(e);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){const s=e||I(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new j(new H(s,d("disableProviderPing")))}}var as=Object.defineProperty,os=(r,t,e)=>t in r?as(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,x=(r,t,e)=>os(r,typeof t!="symbol"?t+"":t,e);class cs{constructor(t){x(this,"name","cosmos"),x(this,"client"),x(this,"httpProviders"),x(this,"events"),x(this,"namespace"),x(this,"chainId"),this.namespace=t.namespace,this.events=d("events"),this.client=d("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(E.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var s;const a=_(e);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){const s=e||I(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new j(new H(s,d("disableProviderPing")))}}var hs=Object.defineProperty,us=(r,t,e)=>t in r?hs(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,B=(r,t,e)=>us(r,typeof t!="symbol"?t+"":t,e);class ls{constructor(t){B(this,"name","algorand"),B(this,"client"),B(this,"httpProviders"),B(this,"events"),B(this,"namespace"),B(this,"chainId"),this.namespace=t.namespace,this.events=d("events"),this.client=d("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){if(!this.httpProviders[t]){const s=e||I(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.chainId=t,this.events.emit(E.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var s;t[e]=this.createHttpProvider(e,(s=this.namespace.rpcMap)==null?void 0:s[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){const s=e||I(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new j(new H(s,d("disableProviderPing")))}}var ps=Object.defineProperty,ds=(r,t,e)=>t in r?ps(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,U=(r,t,e)=>ds(r,typeof t!="symbol"?t+"":t,e);class fs{constructor(t){U(this,"name","cip34"),U(this,"client"),U(this,"httpProviders"),U(this,"events"),U(this,"namespace"),U(this,"chainId"),this.namespace=t.namespace,this.events=d("events"),this.client=d("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(E.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{const s=this.getCardanoRPCUrl(e),a=_(e);t[a]=this.createHttpProvider(a,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}getCardanoRPCUrl(t){const e=this.namespace.rpcMap;if(e)return e[t]}setHttpProvider(t,e){const s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){const s=e||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new j(new H(s,d("disableProviderPing")))}}var ms=Object.defineProperty,vs=(r,t,e)=>t in r?ms(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,F=(r,t,e)=>vs(r,typeof t!="symbol"?t+"":t,e);class gs{constructor(t){F(this,"name","elrond"),F(this,"client"),F(this,"httpProviders"),F(this,"events"),F(this,"namespace"),F(this,"chainId"),this.namespace=t.namespace,this.events=d("events"),this.client=d("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(E.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var s;const a=_(e);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){const s=e||I(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new j(new H(s,d("disableProviderPing")))}}var ys=Object.defineProperty,bs=(r,t,e)=>t in r?ys(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,M=(r,t,e)=>bs(r,typeof t!="symbol"?t+"":t,e);class ws{constructor(t){M(this,"name","multiversx"),M(this,"client"),M(this,"httpProviders"),M(this,"events"),M(this,"namespace"),M(this,"chainId"),this.namespace=t.namespace,this.events=d("events"),this.client=d("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(E.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var s;const a=_(e);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){const s=e||I(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new j(new H(s,d("disableProviderPing")))}}var Ps=Object.defineProperty,Cs=(r,t,e)=>t in r?Ps(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,L=(r,t,e)=>Cs(r,typeof t!="symbol"?t+"":t,e);class Is{constructor(t){L(this,"name","near"),L(this,"client"),L(this,"httpProviders"),L(this,"events"),L(this,"namespace"),L(this,"chainId"),this.namespace=t.namespace,this.events=d("events"),this.client=d("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){if(this.chainId=t,!this.httpProviders[t]){const s=e||I(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(E.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var s;t[e]=this.createHttpProvider(e,(s=this.namespace.rpcMap)==null?void 0:s[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){const s=e||I(t,this.namespace);return typeof s>"u"?void 0:new j(new H(s,d("disableProviderPing")))}}var Os=Object.defineProperty,Es=(r,t,e)=>t in r?Os(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,k=(r,t,e)=>Es(r,typeof t!="symbol"?t+"":t,e);class As{constructor(t){k(this,"name","tezos"),k(this,"client"),k(this,"httpProviders"),k(this,"events"),k(this,"namespace"),k(this,"chainId"),this.namespace=t.namespace,this.events=d("events"),this.client=d("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){if(this.chainId=t,!this.httpProviders[t]){const s=e||I(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(E.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{t[e]=this.createHttpProvider(e)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){const s=e||I(t,this.namespace);return typeof s>"u"?void 0:new j(new H(s))}}var js=Object.defineProperty,Hs=(r,t,e)=>t in r?js(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,z=(r,t,e)=>Hs(r,typeof t!="symbol"?t+"":t,e);class $s{constructor(t){z(this,"name",ie),z(this,"client"),z(this,"httpProviders"),z(this,"events"),z(this,"namespace"),z(this,"chainId"),this.namespace=t.namespace,this.events=d("events"),this.client=d("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(t.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(t.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(t.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(t.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider(t.chainId).request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(E.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getNamespaceName(){const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return tt(t).namespace}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){var t,e;const s={};return(e=(t=this.namespace)==null?void 0:t.accounts)==null||e.forEach(a=>{const o=tt(a);s[o.reference]=this.createHttpProvider(a)}),s}getHttpProvider(t){const e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){const s=e||I(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new j(new H(s,d("disableProviderPing")))}}var Ss=Object.defineProperty,Ds=Object.defineProperties,qs=Object.getOwnPropertyDescriptors,Qt=Object.getOwnPropertySymbols,_s=Object.prototype.hasOwnProperty,Ns=Object.prototype.propertyIsEnumerable,vt=(r,t,e)=>t in r?Ss(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Q=(r,t)=>{for(var e in t||(t={}))_s.call(t,e)&&vt(r,e,t[e]);if(Qt)for(var e of Qt(t))Ns.call(t,e)&&vt(r,e,t[e]);return r},pt=(r,t)=>Ds(r,qs(t)),O=(r,t,e)=>vt(r,typeof t!="symbol"?t+"":t,e);class wt{constructor(t){O(this,"client"),O(this,"namespaces"),O(this,"optionalNamespaces"),O(this,"sessionProperties"),O(this,"scopedProperties"),O(this,"events",new Ee),O(this,"rpcProviders",{}),O(this,"session"),O(this,"providerOpts"),O(this,"logger"),O(this,"uri"),O(this,"disableProviderPing",!1),this.providerOpts=t,this.logger=typeof t?.logger<"u"&&typeof t?.logger!="string"?t.logger:Ae(je({level:t?.logger||Tt})),this.disableProviderPing=t?.disableProviderPing||!1}static async init(t){const e=new wt(t);return await e.initialize(),e}async request(t,e,s){const[a,o]=this.validateChain(e);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(a).request({request:Q({},t),chainId:`${a}:${o}`,topic:this.session.topic,expiry:s})}sendAsync(t,e,s,a){const o=new Date().getTime();this.request(t,s,a).then(i=>e(null,He(o,i))).catch(i=>e(i,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:jt("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}async authenticate(t,e){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(t),await this.cleanupPendingPairings();const{uri:s,response:a}=await this.client.authenticate(t,e);s&&(this.uri=s,this.events.emit("display_uri",s));const o=await a();if(this.session=o.session,this.session){const i=zt(this.session.namespaces);this.namespaces=Z(this.namespaces,i),await this.persist("namespaces",this.namespaces),this.onConnect()}return o}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}removeListener(t,e){this.events.removeListener(t,e)}off(t,e){this.events.off(t,e)}get isWalletConnect(){return!0}async pair(t){const{uri:e,approval:s}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});e&&(this.uri=e,this.events.emit("display_uri",e));const a=await s();this.session=a;const o=zt(a.namespaces);return this.namespaces=Z(this.namespaces,o),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(t,e){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,e)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){try{this.logger.info("Cleaning up inactive pairings...");const e=this.client.pairing.getAll();if(!it(e))return;for(const s of e)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${e.length}`)}catch(e){this.logger.warn("Failed to cleanup pending pairings",e)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var t,e;if(this.client=this.providerOpts.client||await $e.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Tt,relayUrl:this.providerOpts.relayUrl||Fe,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(s){throw this.logger.error("Failed to get session",s),new Error(`The provided session: ${(e=(t=this.providerOpts)==null?void 0:t.session)==null?void 0:e.topic} doesn't exist in the Sign client`)}else{const s=this.client.session.getAll();this.session=s[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(e=>V(e)))];ot("client",this.client),ot("events",this.events),ot("disableProviderPing",this.disableProviderPing),t.forEach(e=>{if(!this.session)return;const s=Or(e,this.session);if(s?.length===0)return;const a=le(s),o=Z(this.namespaces,this.optionalNamespaces),i=pt(Q({},o[e]),{accounts:s,chains:a});switch(e){case"eip155":this.rpcProviders[e]=new rs({namespace:i});break;case"algorand":this.rpcProviders[e]=new ls({namespace:i});break;case"solana":this.rpcProviders[e]=new ns({namespace:i});break;case"cosmos":this.rpcProviders[e]=new cs({namespace:i});break;case"polkadot":this.rpcProviders[e]=new Xr({namespace:i});break;case"cip34":this.rpcProviders[e]=new fs({namespace:i});break;case"elrond":this.rpcProviders[e]=new gs({namespace:i});break;case"multiversx":this.rpcProviders[e]=new ws({namespace:i});break;case"near":this.rpcProviders[e]=new Is({namespace:i});break;case"tezos":this.rpcProviders[e]=new As({namespace:i});break;default:this.rpcProviders[e]=new $s({namespace:i})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{var e;const{topic:s}=t;s===((e=this.session)==null?void 0:e.topic)&&this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{var e;const{params:s,topic:a}=t;if(a!==((e=this.session)==null?void 0:e.topic))return;const{event:o}=s;if(o.name==="accountsChanged"){const i=o.data;i&&it(i)&&this.events.emit("accountsChanged",i.map(kt))}else if(o.name==="chainChanged"){const i=s.chainId,h=s.event.data,u=V(i),m=at(i)!==at(h)?`${u}:${at(h)}`:i;this.onChainChanged(m)}else this.events.emit(o.name,o.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:e})=>{var s,a;if(t!==((s=this.session)==null?void 0:s.topic))return;const{namespaces:o}=e,i=(a=this.client)==null?void 0:a.session.get(t);this.session=pt(Q({},i),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:e})}),this.client.on("session_delete",async t=>{var e;t.topic===((e=this.session)==null?void 0:e.topic)&&(await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",pt(Q({},jt("USER_DISCONNECTED")),{data:t.topic})))}),this.on(E.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){return this.rpcProviders[t]||this.rpcProviders[ie]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var e;this.getProvider(t).updateNamespace((e=this.session)==null?void 0:e.namespaces[t])})}setNamespaces(t){const{namespaces:e={},optionalNamespaces:s={},sessionProperties:a,scopedProperties:o}=t;this.optionalNamespaces=Z(e,s),this.sessionProperties=a,this.scopedProperties=o}validateChain(t){const[e,s]=t?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[e,s];if(e&&!Object.keys(this.namespaces||{}).map(i=>V(i)).includes(e))throw new Error(`Namespace '${e}' is not configured. Please call connect() first with namespace config.`);if(e&&s)return[e,s];const a=V(Object.keys(this.namespaces)[0]),o=this.rpcProviders[a].getDefaultChain();return[a,o]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}async onChainChanged(t,e=!1){if(!this.namespaces)return;const[s,a]=this.validateChain(t);if(!a)return;this.updateNamespaceChain(s,a);const o=this.getProvider(s).getDefaultChain();e?(this.events.emit("chainChanged",a),this.emitAccountsChangedOnChainChange({namespace:s,previousChainId:o,newChainId:t})):this.getProvider(s).setDefaultChain(a),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:t,previousChainId:e,newChainId:s}){var a,o;try{if(e===s)return;const i=(o=(a=this.session)==null?void 0:a.namespaces[t])==null?void 0:o.accounts;if(!i)return;const h=i.filter(u=>u.includes(`${s}:`)).map(kt);if(!it(h))return;this.events.emit("accountsChanged",h)}catch(i){this.logger.warn("Failed to emit accountsChanged on chain change",i)}}updateNamespaceChain(t,e){if(!this.namespaces)return;const s=this.namespaces[t]?t:`${t}:${e}`,a={chains:[],methods:[],events:[],defaultChain:e};this.namespaces[s]?this.namespaces[s]&&(this.namespaces[s].defaultChain=e):this.namespaces[s]=a}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(t,e){var s;const a=((s=this.session)==null?void 0:s.topic)||"";await this.client.core.storage.setItem(`${X}/${t}${a}`,e)}async getFromStore(t){var e;const s=((e=this.session)==null?void 0:e.topic)||"";return await this.client.core.storage.getItem(`${X}/${t}${s}`)}async deleteFromStore(t){var e;const s=((e=this.session)==null?void 0:e.topic)||"";await this.client.core.storage.removeItem(`${X}/${t}${s}`)}async cleanupStorage(){var t;try{if(((t=this.client)==null?void 0:t.session.length)>0)return;const e=await this.client.core.storage.getKeys();for(const s of e)s.startsWith(X)&&await this.client.core.storage.removeItem(s)}catch(e){this.logger.warn("Failed to cleanup storage",e)}}}const Ms=wt;export{Ms as UniversalProvider,wt as default};
//# sourceMappingURL=index.es-C_z5W1Oi.js.map
